<?xml version="1.0" encoding="UTF-8"?>
<!--
  File: .\src\main\resources\mapper\PictureMapper.xml
  Description: Auto-generated file header comment.
  Created: 2025-10-17
-->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lq.common.mapper.PictureMapper">

    <resultMap id="BaseResultMap" type="com.lq.common.model.entity.Picture">
        <id property="id" column="id"/>
        <result property="url" column="url"/>
        <result property="thumbnailUrl" column="thumbnail_url"/>
        <result property="name" column="name"/>
        <result property="introduction" column="introduction"/>
        <result property="category" column="category"/>
        <result property="tags" column="tags"/>
        <result property="picSize" column="pic_size"/>
        <result property="picWidth" column="pic_width"/>
        <result property="picHeight" column="pic_height"/>
        <result property="picScale" column="pic_scale"/>
        <result property="picFormat" column="pic_format"/>
        <result property="userId" column="user_id"/>
        <result property="createTime" column="create_time"/>
        <result property="editTime" column="edit_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="isDelete" column="is_delete"/>
        <result property="reviewStatus" column="review_status"/>
        <result property="reviewMessage" column="review_message"/>
        <result property="reviewerId" column="reviewer_id"/>
        <result property="reviewTime" column="review_time"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,url,thumbnail_url,name,introduction,category,tags,
        pic_size,pic_width,pic_height,pic_scale,pic_format,
        user_id,create_time,edit_time,update_time,is_delete,
        review_status,review_message,reviewer_id,review_time
    </sql>

    <!-- 动态查询条件 -->
    <sql id="Dynamic_Where">
        <where>
            is_delete = 0
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="introduction != null and introduction != ''">
                AND introduction LIKE CONCAT('%', #{introduction}, '%')
            </if>
            <if test="category != null and category != ''">
                AND category = #{category}
            </if>
            <if test="picWidth != null">
                AND pic_width = #{picWidth}
            </if>
            <if test="picHeight != null">
                AND pic_height = #{picHeight}
            </if>
            <if test="picSize != null">
                AND pic_size = #{picSize}
            </if>
            <if test="picScale != null">
                AND pic_scale = #{picScale}
            </if>
            <if test="picFormat != null and picFormat != ''">
                AND pic_format LIKE CONCAT('%', #{picFormat}, '%')
            </if>
            <if test="reviewStatus != null">
                AND review_status = #{reviewStatus}
            </if>
            <if test="reviewerId != null">
                AND reviewer_id = #{reviewerId}
            </if>
            <if test="reviewMessage != null and reviewMessage != ''">
                AND review_message LIKE CONCAT('%', #{reviewMessage}, '%')
            </if>
            <if test="startEditTime != null">
                AND edit_time >= #{startEditTime}
            </if>
            <if test="endEditTime != null">
                AND edit_time &lt; #{endEditTime}
            </if>
            <if test="searchText != null and searchText != ''">
                AND (name LIKE CONCAT('%', #{searchText}, '%') OR introduction LIKE CONCAT('%', #{searchText}, '%'))
            </if>
            <if test="tags != null and tags.size() > 0">
                <foreach collection="tags" item="tag" open="AND (" separator=" OR " close=")">
                    tags LIKE CONCAT('%"', #{tag}, '"%')
                </foreach>
            </if>
        </where>
    </sql>

    <!-- 动态排序 -->
    <sql id="Dynamic_Order">
        <if test="sortField != null and sortField != ''">
            ORDER BY 
            <choose>
                <when test="sortField == 'createTime'">create_time</when>
                <when test="sortField == 'editTime'">edit_time</when>
                <when test="sortField == 'updateTime'">update_time</when>
                <when test="sortField == 'picSize'">pic_size</when>
                <when test="sortField == 'picWidth'">pic_width</when>
                <when test="sortField == 'picHeight'">pic_height</when>
                <when test="sortField == 'picScale'">pic_scale</when>
                <when test="sortField == 'picFormat'">pic_format</when>
                <when test="sortField == 'reviewStatus'">review_status</when>
                <when test="sortField == 'reviewTime'">review_time</when>
                <otherwise>${sortField}</otherwise>
            </choose>
            <if test="sortOrder != null and sortOrder != ''">
                <choose>
                    <when test="sortOrder == 'ascend'">ASC</when>
                    <when test="sortOrder == 'descend'">DESC</when>
                    <otherwise>ASC</otherwise>
                </choose>
            </if>
        </if>
        <if test="sortField == null or sortField == ''">
            ORDER BY create_time DESC
        </if>
    </sql>

    <!-- 根据条件查询图片 -->
    <select id="selectByCondition" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM picture
        <include refid="Dynamic_Where"/>
        <include refid="Dynamic_Order"/>
        <if test="offset != null and limit != null">
            LIMIT #{offset}, #{limit}
        </if>
    </select>

    <!-- 根据条件统计数量 -->
    <select id="countByCondition" resultType="long">
        SELECT COUNT(*)
        FROM picture
        <include refid="Dynamic_Where"/>
    </select>
</mapper>
