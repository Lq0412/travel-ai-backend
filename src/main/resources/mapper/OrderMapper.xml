<?xml version="1.0" encoding="UTF-8"?>
<!--
  File: .\src\main\resources\mapper\OrderMapper.xml
  Description: MyBatis XML for orders.
  Created: 2025-10-17
-->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lq.common.mapper.OrderMapper">

    <resultMap id="OrderResult" type="com.lq.common.model.entity.Order">
        <id property="id" column="id"/>
        <result property="orderNo" column="order_no"/>
        <result property="userId" column="user_id"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="totalAmount" column="total_amount"/>
        <result property="actualAmount" column="actual_amount"/>
        <result property="discountAmount" column="discount_amount"/>
        <result property="status" column="status"/>
        <result property="payTime" column="pay_time"/>
        <result property="payMethod" column="pay_method"/>
        <result property="transactionId" column="transaction_id"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="remark" column="remark"/>
        <result property="shippingAddress" column="shipping_address"/>
        <result property="invoiceInfo" column="invoice_info"/>
        <result property="cancelReason" column="cancel_reason"/>
        <result property="refundReason" column="refund_reason"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="isDelete" column="is_delete"/>
    </resultMap>

    <sql id="Base_Columns">
        id, order_no, user_id, merchant_id, total_amount, actual_amount, discount_amount,
        status, pay_time, pay_method, transaction_id, contact_name, contact_phone, remark,
        shipping_address, invoice_info, cancel_reason, refund_reason, create_time, update_time, is_delete
    </sql>

    <select id="selectByUser" resultMap="OrderResult">
        SELECT <include refid="Base_Columns"/>
        FROM orders
        WHERE is_delete = 0 AND user_id = #{userId}
        ORDER BY create_time DESC
    </select>

    <select id="selectDetail" resultMap="OrderResult">
        SELECT <include refid="Base_Columns"/>
        FROM orders
        WHERE is_delete = 0 AND id = #{orderId} AND user_id = #{userId}
        LIMIT 1
    </select>

    <select id="selectByMerchant" resultMap="OrderResult">
        SELECT <include refid="Base_Columns"/>
        FROM orders
        WHERE is_delete = 0 AND merchant_id = #{merchantId}
        ORDER BY create_time DESC
    </select>

    <select id="selectDetailByMerchant" resultMap="OrderResult">
        SELECT <include refid="Base_Columns"/>
        FROM orders
        WHERE is_delete = 0 AND id = #{orderId} AND merchant_id = #{merchantId}
        LIMIT 1
    </select>

</mapper>


